package anc

import (
	"encoding/hex"
	"fmt"
	"testing"
)

func TestPesParsing(t *testing.T) {
	pesPayloads := []string{
		"000001bd0016858005231a339e4d0003800250405048620071e008d3",
		"000001bd0016858005231a3392930003800250405048620071e008d3",
		"000001bd004a858005231a33929300030001614062ba5a698ad7f50d9b8f2727aafc60180bea00802fa80200bea00802fa80200bea00802fa80200bea00802fa80200bea008027466e3c7418dfffffff",
		"000001bd0016858005231a390c050003800250405048620071e008d3",
		"000001bd0026858005231a3917bf00025e2260981106620098200502008c20098200482008020098200463ff",
		"000001bd0036858005231a3917bf00029e224140504626ca6010146b00029e4e6098110a420098200502008c20098200482008020098200843ffffff",
		"000001bd0016858005231a3917bf0003800250405048620071e008d3",
		"000001bd0026858005231a39237b00025e226098110a410898200502006c20098200482008020098200a63ff",
		"000001bd0036858005231a39237b00029e224140504626ca6010146b00029e4e6098110a420098200502008c20098200482008020098200843ffffff",
		"000001bd0016858005231a39237b0003800250405048620071e008d3",
		"000001bd0026858005231a392f3500025e2260981104220050200942008c200982004820080200982009e3ff",
		"000001bd0036858005231a392f3500029e224140504626ca6010146b00029e4e60981108020050200942008c200982004820080200982005c3ffffff",
	}
	for _, pesStr := range pesPayloads {
		pes, _ := hex.DecodeString(pesStr)
		h, err := ParseAncPes(pes)
		if err != nil || h == nil {
			t.Fail()
		} else {
			fmt.Println(h.String())
		}

	}
}
func TestPesParsingProblems(t *testing.T) {
	pesPayloadsProblem := []string{
		"000001bd004a858005231a3917bf00030001614062ba5a698ad7f50d9b5ce727a9fd60180bea00802fa80200bea00802fa80200bea00802fa80200bea008027466d735868dfff",
		"000001bd004a858005231a39237b00030001614062ba5a698ad7f50d9b9d2727aafc60180bea00802fa80200bea00802fa80200bea008027466e749828dfff",
		"000001bd004a858005231a392f3500030001614062ba5a698ad7f50d9b5d6727a9fd60180bea00802fa80200bea00802fa80200bea008027466d755768dfff",
	}
	for _, pesStr := range pesPayloadsProblem {
		pes, _ := hex.DecodeString(pesStr)
		h, err := ParseAncPes(pes)
		if err != nil || h == nil {
			t.Skip("Problem PES fail")
		}
		fmt.Println(h.String())

	}
}
